(function(b){var c=0,a,e,k=b.tmpl,g=b.template,l=jQuery.fn.domManip,d,f='<table class="plusViewerTabs"><tbody><tr><th class="header_${activeIndex === 0}">Result</th><th class="header_${activeIndex === 1}">Data</th>{{each tmpls}}<th class="header_${activeIndex === 2 + $index}">${$value.name}</th>{{/each}}</tr><tr><td colspan="${tmpls.length + 2}">{{if activeIndex === 0}}{{wrap wrapper}}{{tmpl(data) tmpls[0].tmpl}}{{/wrap}}{{else activeIndex === 1}}<textarea{{if !editable}} readonly{{/if}}>${$item.getData()}</textarea>{{else}}<textarea{{if !editable}} readonly{{/if}}>${tmpls[activeIndex - 2].markup}</textarea>{{/if}}</td></tr></tbody></table>';f=b.template(null,f);b.tmpl=function(f,d,e,b){if(!c&&!b)a={tmpls:[],tmplNames:{},activeIndex:0,data:d};return k(f,d,e,b)};b.extend(b.tmpl,k);b.template=function(d,e){var f,h,b=e;if(a&&a.tmplNames[d])return a.tmpls[a.tmplNames[d]-1].tmpl;else if(b&&!c){if(b instanceof jQuery)b=e[0]||{};if(b.nodeType){f="#"+b.getAttribute("id");b=b.innerHTML}if(typeof b==="string"){h=f||b;if(!a.tmplNames[h]){a.tmpls.push({markup:b,tmpl:b=g(d,e),name:f||"Template"});a.tmplNames[h]=a.tmpls.length;return b}}}return g(d,e)};jQuery.fn.extend({domManip:function(){if(!c){var f=0,e=this[0],d=b(e),g;d.addClass("plusViewerTarget");while(e!==document.body){if(d.hasClass("plusViewer")){a.wrapper=e.innerHTML;a.depth=f;a.persist=d.hasClass("persist"),g=a.tabs=d.hasClass("tabs"),a.editable=a.persist||d.hasClass("edit");d.data("plusViewerState",a);d.data("plusViewerInitialState",b.extend(true,{},a));a=null;break}d=b(e=e.parentNode);f++}}var i=l.apply(this,arguments);if(g){c++;h(d);c--}else!a&&d.addClass("plusTargetContainer");return i}});function h(c){a=c.data("plusViewerState");if(a.wrapper){var d=a.wrapper.split("plusViewerTarget");d[1]=d[1].replace(/>[\w\s]*</,">{{html $item.html()}}</");a.wrapper=d.join("plusViewerTarget")}else a.wrapper="{{! }}{{html $item.html()}}";if(a.tabs)if(c.hasClass("data"))a.activeIndex=1;else b.each(a.tmplNames,function(d,b){if(c.hasClass(d)){a.activeIndex=b+1;return false}});b.tmpl(f,a,{getData:j}).appendTo(c.empty());a.tabs&&a.activeIndex&&i(c)}function i(c){var a=b(c).find("textarea")[0];if(a){a.style.overflow="hidden";a.scrollHeight;a.style.height=a.scrollHeight+"px";a.style.overflow="auto"}}function j(){return JSON.stringify(this.data.data,null,"\t")}b(function(){d=document.createElement("div");d.innerHTML="+";d.className="plusButton";document.body.appendChild(d);b(".plusViewer").delegate(".header_false","click",function(){var f,d=b.tmplItem(this),e=d.data.activeIndex=b(this).index();c++;a=d.data;d.update();a=null;c--;if(!e)return;i(d.nodes[0])}).delegate("textarea","change",function(){var a=b.tmplItem(this);if(a.data.activeIndex===1)try{a.data.data=b.parseJSON(this.value)}catch(g){alert("Syntax error!");this.value=j.call(a)}else{c++;var e=this.value,f=b.template(null,e),d=a.data.tmpls[a.data.activeIndex-2];try{f(b,b.extend({},a,{data:a.data.data[0]||a.data.data}));a.data.targetMarkup=e;d.markup=e;d.tmpl=f}catch(g){alert("Syntax error!");this.value=d.markup}c--}});b(".plusTargetContainer").live("mouseenter",function(c){if(c.relatedTarget&&c.relatedTarget.className==="plusButton")return;if(e)e.style.border="solid transparent 1px";e=this;d.innerHTML=b(this).hasClass("activeViewer")?"-":"+";var a=b(this).offset();this.style.border="solid green 1px";d.style.left=a.left+"px";d.style.top=a.top+"px";d.style.display="block"});b(".plusTargetContainer").live("mouseleave",function(a){if(a.relatedTarget&&a.relatedTarget.className==="plusButton")return;e=null;d.style.display="none";this.style.border="solid transparent 1px"});b(".plusButton").click(function(){c++;var d=b(e);if(this.innerHTML==="+"){h(d);d.addClass("activeViewer");this.innerHTML="-"}else{var f=b(e).children().first().tmplItem(),j=f.nodes,g=document.createElement("div"),k=j[0].parentNode,l=f.data.depth,i=d.data("plusViewerInitialState");g.innerHTML=i.wrapper;if(f.data.persist){a=f.data;d.data("plusViewerState",a)}else{a=i;d.data("plusViewerState",b.extend(true,{},a))}b.tmpl(a.tmpls[0].tmpl,a.data).appendTo(b(g).find(".plusViewerTarget"));jQuery(j).remove();k.innerHTML=g.innerHTML;this.innerHTML="+";d.removeClass("activeViewer")}a=null;c--})})})(jQuery);if(!this.JSON)this.JSON={};(function(){function c(a){return a<10?"0"+a:a}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,d,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},b;function g(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=i[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(m,n){var i,j,h,k,l=a,f,c=n[m];if(c&&typeof c==="object"&&typeof c.toJSON==="function")c=c.toJSON(m);if(typeof b==="function")c=b.call(n,m,c);switch(typeof c){case"string":return g(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";a+=d;f=[];if(Object.prototype.toString.apply(c)==="[object Array]"){k=c.length;for(i=0;i<k;i+=1)f[i]=e(i,c)||"null";h=f.length===0?"[]":a?"[\n"+a+f.join(",\n"+a)+"\n"+l+"]":"["+f.join(",")+"]";a=l;return h}if(b&&typeof b==="object"){k=b.length;for(i=0;i<k;i+=1){j=b[i];if(typeof j==="string"){h=e(j,c);h&&f.push(g(j)+(a?": ":":")+h)}}}else for(j in c)if(Object.hasOwnProperty.call(c,j)){h=e(j,c);h&&f.push(g(j)+(a?": ":":")+h)}h=f.length===0?"{}":a?"{\n"+a+f.join(",\n"+a)+"\n"+l+"}":"{"+f.join(",")+"}";a=l;return h}}if(typeof JSON.stringify!=="function")JSON.stringify=function(h,c,f){var g;a="";d="";if(typeof f==="number")for(g=0;g<f;g+=1)d+=" ";else if(typeof f==="string")d=f;b=c;if(c&&typeof c!=="function"&&(typeof c!=="object"||typeof c.length!=="number"))throw new Error("JSON.stringify");return e("",{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(a,c){var b;function d(f,g){var b,e,a=f[g];if(a&&typeof a==="object")for(b in a)if(Object.hasOwnProperty.call(a,b)){e=d(a,b);if(e!==undefined)a[b]=e;else delete a[b]}return c.call(f,g,a)}a=String(a);h.lastIndex=0;if(h.test(a))a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){b=eval("("+a+")");return typeof c==="function"?d({"":b},""):b}throw new SyntaxError("JSON.parse");}})();